{
    "$schema": "https://docs.renovatebot.com/renovate-schema.json",
    "extends": [
        "github>SonarSource/renovate-config:slim",
        ":maintainLockFilesWeekly",
        ":enablePreCommit",
        "docker:enableMajor",
        "docker:pinDigests"
    ],
    "enabledManagers": ["github-actions", "regex"],
    "github-actions": {
        "fileMatch": ["^(github-action)(\\/[^/]+)?\\/action\\.ya?ml$"]
    },
    "packageRules": [
        {
            "matchPackagePatterns": [".*sonar-(ubuntu|windowsserver)-.*"],
            "addLabels": ["golden-ami"]
        }
    ],
    "regexManagers": [
        {
            "fileMatch": [".*pkrvars.hcl$", ".*tfvars$"],
            "matchStrings": [
                ".*amiFilter=(?<packageName>.*?)\\n(.*currentImageName=(?<currentDigest>.*?)\\n)?(.*\\n)?.*?(?<depName>[a-zA-Z0-9-_:]*)[ ]*?[:|=][ ]*?[\\\"|\"]?(?<currentValue>ami-[a-z0-9]{17})[\\\"|\"]?.*"
            ],
            "datasourceTemplate": "aws-machine-image",
            "versioningTemplate": "aws-machine-image"
        },
        {
            "fileMatch": ["^cdk.context.json$"],
            "matchStrings": [
                ".*[\\\"|\"]ami:account=[0-9]{12}:filters\\.image-type\\.0=(?<imageType>.*?):filters\\.name\\.0=(?<imageName>.*?):.*[\\\"|\"]:[ ]*?[\\\"|\"]?(?<currentValue>ami-[a-z0-9]{17})[\\\"|\"]?"
            ],
            "datasourceTemplate": "aws-machine-image",
            "versioningTemplate": "aws-machine-image",
            "packageNameTemplate": "[{\"Name\":\"name\",\"Values\":[\"{{{imageName}}}\"]},{\"Name\":\"state\",\"Values\":[\"available\"]},{\"Name\":\"image-type\",\"Values\":[\"{{{imageType}}}\"]},{\"Name\":\"is-public\",\"Values\":[\"false\"]}]",
            "depNameTemplate": "{{{replace ' \\*' '' imageName}}}"
        }
    ]
}
